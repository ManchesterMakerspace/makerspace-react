FROM ruby:2.3

RUN apt-get update -qq && apt-get install -y build-essential libpq-dev nodejs curl
RUN curl -sL https://deb.nodesource.com/setup_8.x  | bash -
RUN apt-get install -y nodejs

RUN mkdir /myapp
WORKDIR /myapp

COPY package.json /myapp/package.json
RUN npm install
RUN cp /myapp/node_modules/phantomjs-prebuilt/lib/phantom/bin/phantomjs /usr/bin/phantomjs

COPY Gemfile /myapp/Gemfile
COPY Gemfile.lock /myapp/Gemfile.lock
RUN bundle install

COPY Docker/scripts/integration_test.sh /bin/integration_test.sh
RUN chmod +x /bin/integration_test.sh
COPY . /myapp
CMD ["/bin/integration_test.sh"]
